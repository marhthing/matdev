# Media Downloader API Documentation

## Overview
This serverless API enables downloading media content from major social platforms including Instagram, TikTok, YouTube, Facebook, and Twitter/X. The API features proxy rotation, anti-detection measures, and rate limiting to reliably extract media content.

## Base URL
```
https://matdev-api-xdry.vercel.app
```

## Endpoints

### 1. Download Media
**POST** `/api/download`

Download media from supported platforms.

#### Request Headers
```
Content-Type: application/json
User-Agent: YourBotName/1.0
```

#### Request Body
```json
{
  "url": "https://youtube.com/shorts/wROHpu1GDbg",
  "type": "youtube",
  "quality": "medium"
}
```

#### Parameters
- `url` (required): The media URL to download
- `type` (optional): Platform type (`youtube`, `tiktok`, `instagram`, `facebook`, `twitter`). Auto-detected if not provided.
- `quality` (optional): Desired quality (`low`, `medium`, `high`, `720p`, `1080p`). Default: `medium`

#### Response
```json
{
  "success": true,
  "platform": "youtube",
  "url": "https://youtube.com/shorts/example",
  "response_time": 1250,
  "timestamp": "2025-09-12T07:13:45.123Z",
  "data": {
    "platform": "youtube",
    "title": "Video Title",
    "author": "Channel Name",
    "duration": 16,
    "media": [
      {
        "type": "video",
        "url": "https://direct-video-url.mp4",
        "title": "Video Title",
        "quality": "360p",
        "thumbnail": "https://thumbnail-url.jpg"
      }
    ]
  }
}
```

### 2. Search YouTube
**POST** `/api/search` or **GET** `/api/search`

Search for YouTube videos.

#### POST Request Body
```json
{
  "query": "search terms",
  "limit": 5
}
```

#### GET Query Parameters
```
GET /api/search?q=search+terms&limit=5
```

#### Response
```json
{
  "success": true,
  "query": "search terms",
  "results": [
    {
      "title": "Video Title",
      "url": "https://youtube.com/watch?v=...",
      "thumbnail": "https://thumbnail-url.jpg",
      "duration": "0:16",
      "author": "Channel Name",
      "views": "1.2M views"
    }
  ],
  "count": 5,
  "timestamp": "2025-09-12T07:13:45.123Z"
}
```

### 3. API Status
**GET** `/api/status`

Check API health and statistics.

#### Response
```json
{
  "success": true,
  "api_version": "1.0.0",
  "timestamp": "2025-09-12T07:13:45.123Z",
  "uptime": 12345,
  "supported_platforms": [
    "instagram", "tiktok", "youtube", "facebook", "twitter"
  ],
  "proxy_stats": {
    "total": 0,
    "active": 0,
    "failed": 0
  },
  "rate_limit_stats": {
    "requests_per_minute": 20,
    "window_ms": 60000
  },
  "environment": "production"
}
```

## Bot Integration Examples

### Node.js Example
```javascript
const axios = require('axios');

const API_BASE = 'https://matdev-api-xdry.vercel.app';

async function downloadMedia(url, platform = null, quality = 'medium') {
  try {
    const response = await axios.post(`${API_BASE}/api/download`, {
      url: url,
      type: platform,
      quality: quality
    }, {
      headers: {
        'Content-Type': 'application/json',
        'User-Agent': 'MyBot/1.0'
      },
      timeout: 30000 // 30 seconds
    });
    
    if (response.data.success) {
      const media = response.data.data.media[0];
      console.log('Title:', response.data.data.title);
      console.log('Download URL:', media.url);
      return media.url;
    } else {
      throw new Error(response.data.message || 'Download failed');
    }
  } catch (error) {
    console.error('API Error:', error.message);
    if (error.response) {
      console.error('Status:', error.response.status);
      console.error('Response:', error.response.data);
    }
    throw error;
  }
}

// Usage
downloadMedia('https://youtube.com/shorts/example')
  .then(downloadUrl => {
    console.log('Ready to download:', downloadUrl);
    // Use downloadUrl to fetch the actual video file
  })
  .catch(console.error);
```

### Python Example
```python
import requests
import json

API_BASE = 'https://matdev-api-xdry.vercel.app'

def download_media(url, platform=None, quality='medium'):
    try:
        response = requests.post(f'{API_BASE}/api/download', 
            json={
                'url': url,
                'type': platform,
                'quality': quality
            },
            headers={
                'Content-Type': 'application/json',
                'User-Agent': 'MyBot/1.0'
            },
            timeout=30
        )
        
        data = response.json()
        
        if data['success']:
            media = data['data']['media'][0]
            print(f"Title: {data['data']['title']}")
            print(f"Download URL: {media['url']}")
            return media['url']
        else:
            raise Exception(data.get('message', 'Download failed'))
            
    except requests.RequestException as e:
        print(f"API Error: {e}")
        if hasattr(e, 'response') and e.response:
            print(f"Status: {e.response.status_code}")
            print(f"Response: {e.response.text}")
        raise

# Usage
try:
    download_url = download_media('https://youtube.com/shorts/example')
    print(f"Ready to download: {download_url}")
    # Use download_url to fetch the actual video file
except Exception as e:
    print(f"Error: {e}")
```

### cURL Example
```bash
# Download media
curl -X POST https://matdev-api-xdry.vercel.app/api/download \
  -H "Content-Type: application/json" \
  -H "User-Agent: MyBot/1.0" \
  -d '{
    "url": "https://youtube.com/shorts/example",
    "quality": "medium"
  }'

# Search YouTube
curl -X GET "https://matdev-api-xdry.vercel.app/api/search?q=funny+cats&limit=3"

# Check status
curl https://matdev-api-xdry.vercel.app/api/status
```

## Platform Support Status

| Platform | Status | Notes |
|----------|---------|-------|
| YouTube | ‚úÖ Fully Working | Supports videos, shorts, live streams |
| TikTok | ‚úÖ Fully Working | Supports videos and image slideshows |
| Twitter/X | ‚úÖ Fully Working | Videos and images via FxTwitter API |
| Instagram | üîÑ Testing Required | Posts, reels, stories |
| Facebook | ‚ö†Ô∏è Limited | Requires browser automation for most videos |

## Error Handling

### Error Response Format
```json
{
  "success": false,
  "error": "Error Type",
  "message": "Human readable error message",
  "response_time": 500,
  "timestamp": "2025-09-12T07:13:45.123Z"
}
```

### Common Errors

#### Rate Limit Exceeded (429)
```json
{
  "success": false,
  "error": "Rate limit exceeded",
  "message": "Too many requests. Please wait before trying again.",
  "retry_after": 60
}
```

#### Invalid URL (400)
```json
{
  "success": false,
  "error": "Invalid URL",
  "message": "Please provide a valid URL"
}
```

#### Unsupported Platform (400)
```json
{
  "success": false,
  "error": "Unsupported URL",
  "message": "This URL is not supported. Supported platforms: Instagram, TikTok, YouTube, Facebook, Twitter/X"
}
```

#### Facebook Browser Required (501)
```json
{
  "success": false,
  "error": "Download failed",
  "message": "FACEBOOK_BROWSER_REQUIRED: Dynamic JS-only video URL, requires browser automation"
}
```

## Rate Limits

- **Downloads**: 20 requests per minute per IP
- **Search**: 10 requests per minute per IP
- **Status**: No rate limit

## Best Practices

### 1. Handle Rate Limits
Always check for 429 status codes and implement retry logic with exponential backoff.

### 2. Set Appropriate Timeouts
API responses can take 15-30 seconds for video processing. Set timeouts accordingly.

### 3. Cache Results
Cache successful responses to reduce API calls and improve performance.

### 4. Handle Errors Gracefully
Always check the `success` field and handle different error types appropriately.

### 5. Use User-Agent Headers
Include a descriptive User-Agent header to identify your bot.

## Proxy Configuration (Optional)

To avoid IP blocking, configure proxies via environment variables:

```bash
# HTTP/HTTPS Proxies (comma-separated)
HTTP_PROXIES=http://user:pass@proxy1:8080,http://user:pass@proxy2:8080

# SOCKS5 Proxies (comma-separated)  
SOCKS_PROXIES=socks5://user:pass@proxy1:1080,socks5://user:pass@proxy2:1080
```

## Deployment

The API is designed for serverless deployment on Vercel:

1. Push code to GitHub repository
2. Connect repository to Vercel
3. Deploy automatically
4. Configure environment variables if using proxies

## Support

For issues or questions:
1. Check the error message and response code
2. Verify the URL format is correct
3. Ensure rate limits aren't exceeded
4. Test with the `/api/status` endpoint to verify API health